{% extends "base.html" %}
{% block content %}
<div class="container">
    <h1>Configura Riquadro</h1>
    <form method="POST" action="{{ url_for('configura_riquadro', area=area, sotto_area=sotto_area, riquadro=riquadro) }}">
        
        <!-- Grande casella di testo per inserire i codici a barre -->
        <div class="form-group">
            <label for="codici_a_barre_textarea">Inserisci Codici a Barre (uno per riga):</label>
            <textarea id="codici_a_barre_textarea" name="codici_a_barre_textarea" class="form-control" rows="10" placeholder="Inserisci i codici a barre qui..."></textarea>
        </div>

        <!-- Sezione per mostrare i nomi delle bottiglie trovate -->
        <div class="form-group">
            <label>Nomi delle Bottiglie:</label>
            <ul id="nomi_bottiglie_list"></ul>
        </div>

        <div class="form-group">
            <button type="submit" class="btn btn-primary">Salva Configurazione</button>
        </div>
    </form>
</div>

<script>
    document.getElementById('codice_a_barre_input').addEventListener('input', function() {
    const codiceABarre = this.value.trim();

    if (codiceABarre) {
        fetch(`/assegna_bottiglia_ajax?codice_a_barre=${codiceABarre}`)
            .then(response => response.json())
            .then(data => {
                if (data.Descrizione) {
                    document.getElementById('descrizione').textContent = `Bottiglia: ${data.Descrizione}`;
                } else {
                    document.getElementById('descrizione').textContent = 'Bottiglia non trovata';
                }
            })
            .catch(error => {
                console.error('Errore nel recupero della bottiglia:', error);
                document.getElementById('descrizione').textContent = 'Errore nel recupero della bottiglia';
            });
    }
});
</script>
{% endblock %}
