{% extends "base.html" %}

{% block content %}
<div class="modifica-container">
    <h2>Modifica Quantità e Collocazioni</h2>

    <form method="POST" action="{{ url_for('modifica_gestione_magazzino', id=bottiglia._id) }}">
        <!-- Gestione delle collocazioni e quantità -->
        <div id="collocazioni-container">
            {% for collocazione in bottiglia.collocazioni %}
            <div class="collocazione-item">
                <label for="collocazione_1_{{ loop.index }}">Collocazione 1</label>
                <select id="collocazione_1_{{ loop.index }}" name="collocazione_1">
                    <option value="Sala Principale" {% if collocazione.collocazione_1 == 'Sala Principale' %}selected{% endif %}>Sala Principale</option>
                    <option value="Sala Secondaria" {% if collocazione.collocazione_1 == 'Sala Secondaria' %}selected{% endif %}>Sala Secondaria</option>
                    <option value="Soppalco" {% if collocazione.collocazione_1 == 'Soppalco' %}selected{% endif %}>Soppalco</option>
                </select>

                <label for="collocazione_2_{{ loop.index }}">Collocazione 2</label>
                <select id="collocazione_2_{{ loop.index }}" name="collocazione_2">
                    {% if collocazione.collocazione_1 == 'Sala Principale' %}
                        <option value="Frigo" {% if collocazione.collocazione_2 == 'Frigo' %}selected{% endif %}>Frigo</option>
                        <option value="Scaffali" {% if collocazione.collocazione_2 == 'Scaffali' %}selected{% endif %}>Scaffali</option>
                    {% elif collocazione.collocazione_1 in ['Sala Secondaria', 'Soppalco'] %}
                        <option value="Scaffali" {% if collocazione.collocazione_2 == 'Scaffali' %}selected{% endif %}>Scaffali</option>
                    {% endif %}
                </select>

                <label for="quantita_{{ loop.index }}">Quantità</label>
                <input type="number" id="quantita_{{ loop.index }}" name="quantita" min="1" value="{{ collocazione.quantita }}" required>
            </div>
            {% endfor %}
        </div>

        <button type="submit">Salva Modifiche</button>
    </form>
</div>

<script>
    // Funzione per aggiornare le opzioni di Collocazione 2 in base alla selezione di Collocazione 1
    function updateCollocazione2(selectElement) {
        var collocazione1 = selectElement.value;
        var collocazione2 = selectElement.closest('.collocazione-item').querySelector('select[name="collocazione_2"]');

        // Resetta le opzioni di "Collocazione 2"
        collocazione2.innerHTML = '';

        // Aggiungi opzioni basate sulla selezione di "Collocazione 1"
        if (collocazione1 === 'Sala Principale') {
            collocazione2.add(new Option('Frigo', 'Frigo'));
            collocazione2.add(new Option('Scaffali', 'Scaffali'));
        } else if (collocazione1 === 'Sala Secondaria' || collocazione1 === 'Soppalco') {
            collocazione2.add(new Option('Scaffali', 'Scaffali'));
        }
    }

    // Assegna l'evento onchange a tutte le select di collocazione_1
    document.querySelectorAll('select[name="collocazione_1"]').forEach(function(selectElement) {
        selectElement.addEventListener('change', function() {
            updateCollocazione2(selectElement);
        });
    });
</script>
{% endblock %}
